{"version":3,"file":"modal-zoom.min.js","sources":["../src/modal-zoom.js"],"sourcesContent":["define(['core/templates', 'core/str'], function(templates) {\n\n    var modalTitle = '';\n    var modalZoomSelector = '#block_onlineexam_exams_content';\n\n    var popupinfotitle = '';\n    var popupinfocontent = '';\n    var userlogintime = 0;\n\n    var doRefresh = function() {\n        var myElement = document.getElementById(\"block_onlineexam_contentframe\");\n        if (myElement) {\n            var oldsrc = myElement.src;\n            myElement.src = '';\n            myElement.src = oldsrc;\n        }\n    };\n\n    var handleClickSmallModal = function(e) {\n        e.preventDefault();\n\n        var modalZoomElem = e.target;\n\n        var originalIframe = modalZoomElem.querySelector('iframe');\n\n        var templatePromise = null;\n\n        if (originalIframe !== null) {\n            // Open from Moodle page, i.e., onlineexam iframe exists.\n            templatePromise = templates.render('block_onlineexam/modal-iframe', {\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\n                src: originalIframe.src + \"&modalZoom=1\",\n                title: modalTitle\n            });\n        } else {\n            // Open from iframe, i.e., needs to switch to parent Moodle page.\n            originalIframe = parent.document.querySelector('iframe');\n            templatePromise = templates.render('block_onlineexam/modal-iframe', {\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\n                src: originalIframe.src + \"&modalZoom=1\",\n                title: modalTitle\n            });\n        }\n\n        templatePromise.done(function(source) {\n\n            var div = document.createElement('div');\n            div.innerHTML = source;\n\n            var modalContainer = div.firstChild;\n\n            document.body.insertBefore(modalContainer, document.body.firstChild);\n            document.body.className += ' block_onlineexam_custom-modal-open';\n\n            var closeCallback = function() {\n\n                document.body.className = document.body.className.replace(' block_onlineexam_custom-modal-open', '');\n\n                doRefresh();\n\n                modalContainer.className += ' fading';\n\n                setTimeout(function() {\n                    if (modalContainer.parentNode !== null) {\n                        modalContainer.parentNode.removeChild(modalContainer);\n                    }\n                }, 250);\n            };\n\n            modalContainer.querySelector('.block_onlineexam_custom-modal_close-button')\n                .addEventListener('click', function(e) {\n                    e.preventDefault();\n                    return closeCallback(e);\n                });\n\n            modalContainer.addEventListener('click', function(e) {\n                e.preventDefault();\n\n                return e.target !== modalContainer ?\n                    false : closeCallback(e);\n            });\n        });\n    };\n\n    return {\n        init: function(popuptitle, popupcontent, currentlogin) {\n\n            popupinfotitle = popuptitle;\n            popupinfocontent = popupcontent;\n            userlogintime = currentlogin;\n\n            var zoomContainer = document.querySelectorAll(modalZoomSelector);\n\n            for (var i = 0; i < zoomContainer.length; i++) {\n                zoomContainer[i].addEventListener('click', handleClickSmallModal);\n            }\n\n            // Namespace in window for EVAEXAM-functions etc.\n            window.EVAEXAM = {\n                // Define \"global\" functions in namespace -> later \"external\" access from iframe possible.\n                generatepopupinfo: this.generatepopupinfo\n            };\n            window.evaexamGeneratePopupinfo = this.generatepopupinfo;\n        },\n        generatepopupinfo: function() {\n\n            // Get saved data from sessionStorage.\n            var popupinfo = sessionStorage.getItem('onlineexam_popupinfo');\n\n            if (popupinfo == false || popupinfo === null || popupinfo != userlogintime) {\n\n                // Save data to sessionStorage.\n                sessionStorage.setItem('onlineexam_popupinfo', userlogintime);\n\n                var templatePromise = templates.render('block_onlineexam/popupinfo', {\n                    title: popupinfotitle,\n                    content: popupinfocontent\n                });\n\n                templatePromise.done(function(source) {\n\n                    var div = document.createElement('div');\n                    div.innerHTML = source;\n\n                    var modalContainer = div.firstChild;\n\n                    document.body.insertBefore(modalContainer, document.body.firstChild);\n                    document.body.className += ' block_onlineexam_custom-modal-open popupinfo';\n\n                    var closeCallback = function() {\n\n                        document.body.className = document.body.className.replace(' block_onlineexam_custom-modal-open', '');\n\n                        modalContainer.className += ' fading';\n\n                        setTimeout(function() {\n                            if (modalContainer.parentNode !== null) {\n                                modalContainer.parentNode.removeChild(modalContainer);\n                            }\n                        }, 250);\n                    };\n\n                    modalContainer.querySelector('.block_onlineexam_custom-modal_close-button')\n                    .addEventListener('click', function(e) {\n                        e.preventDefault();\n                        return closeCallback(e);\n                    });\n\n                    modalContainer.addEventListener('click', function(e) {\n                        e.preventDefault();\n\n                        return e.target !== modalContainer ?\n                                false : closeCallback(e);\n                    });\n                });\n            }\n        }\n    };\n});\n"],"names":["define","templates","popupinfotitle","popupinfocontent","userlogintime","handleClickSmallModal","e","preventDefault","originalIframe","target","querySelector","parent","document","render","src","title","done","source","div","createElement","innerHTML","modalContainer","firstChild","body","insertBefore","className","closeCallback","replace","myElement","getElementById","oldsrc","doRefresh","setTimeout","parentNode","removeChild","addEventListener","init","popuptitle","popupcontent","currentlogin","zoomContainer","querySelectorAll","i","length","window","EVAEXAM","generatepopupinfo","this","evaexamGeneratePopupinfo","popupinfo","sessionStorage","getItem","setItem","content"],"mappings":"AAAAA,qCAAO,CAAC,iBAAkB,aAAa,SAASC,eAKxCC,eAAiB,GACjBC,iBAAmB,GACnBC,cAAgB,EAWhBC,sBAAwB,SAASC,GACjCA,EAAEC,qBAIEC,eAFgBF,EAAEG,OAEaC,cAAc,UAI1B,OAAnBF,iBASAA,eAAiBG,OAAOC,SAASF,cAAc,WAP7BT,UAAUY,OAAO,gCAAiC,CAEhEC,IAAKN,eAAeM,IAAM,eAC1BC,MA9BK,KA0CGC,MAAK,SAASC,YAEtBC,IAAMN,SAASO,cAAc,OACjCD,IAAIE,UAAYH,WAEZI,eAAiBH,IAAII,WAEzBV,SAASW,KAAKC,aAAaH,eAAgBT,SAASW,KAAKD,YACzDV,SAASW,KAAKE,WAAa,0CAEvBC,cAAgB,WAEhBd,SAASW,KAAKE,UAAYb,SAASW,KAAKE,UAAUE,QAAQ,sCAAuC,IA/C7F,eACRC,UAAYhB,SAASiB,eAAe,oCACpCD,UAAW,KACPE,OAASF,UAAUd,IACvBc,UAAUd,IAAM,GAChBc,UAAUd,IAAMgB,QA4CZC,GAEAV,eAAeI,WAAa,UAE5BO,YAAW,WAC2B,OAA9BX,eAAeY,YACfZ,eAAeY,WAAWC,YAAYb,kBAE3C,MAGPA,eAAeX,cAAc,+CACxByB,iBAAiB,SAAS,SAAS7B,UAChCA,EAAEC,iBACKmB,mBAGfL,eAAec,iBAAiB,SAAS,SAAS7B,UAC9CA,EAAEC,iBAEKD,EAAEG,SAAWY,gBACRK,6BAKjB,CACHU,KAAM,SAASC,WAAYC,aAAcC,cAErCrC,eAAiBmC,WACjBlC,iBAAmBmC,aACnBlC,cAAgBmC,qBAEZC,cAAgB5B,SAAS6B,iBAxFb,mCA0FPC,EAAI,EAAGA,EAAIF,cAAcG,OAAQD,IACtCF,cAAcE,GAAGP,iBAAiB,QAAS9B,uBAI/CuC,OAAOC,QAAU,CAEbC,kBAAmBC,KAAKD,mBAE5BF,OAAOI,yBAA2BD,KAAKD,mBAE3CA,kBAAmB,eAGXG,UAAYC,eAAeC,QAAQ,wBAEtB,GAAbF,WAAoC,OAAdA,WAAsBA,WAAa7C,gBAGzD8C,eAAeE,QAAQ,uBAAwBhD,eAEzBH,UAAUY,OAAO,6BAA8B,CACjEE,MAAOb,eACPmD,QAASlD,mBAGGa,MAAK,SAASC,YAEtBC,IAAMN,SAASO,cAAc,OACjCD,IAAIE,UAAYH,WAEZI,eAAiBH,IAAII,WAEzBV,SAASW,KAAKC,aAAaH,eAAgBT,SAASW,KAAKD,YACzDV,SAASW,KAAKE,WAAa,oDAEvBC,cAAgB,WAEhBd,SAASW,KAAKE,UAAYb,SAASW,KAAKE,UAAUE,QAAQ,sCAAuC,IAEjGN,eAAeI,WAAa,UAE5BO,YAAW,WAC2B,OAA9BX,eAAeY,YACfZ,eAAeY,WAAWC,YAAYb,kBAE3C,MAGPA,eAAeX,cAAc,+CAC5ByB,iBAAiB,SAAS,SAAS7B,UAChCA,EAAEC,iBACKmB,mBAGXL,eAAec,iBAAiB,SAAS,SAAS7B,UAC9CA,EAAEC,iBAEKD,EAAEG,SAAWY,gBACJK"}